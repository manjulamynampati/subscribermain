<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Events Page</title>
    <script>
        document.addEventListener("DOMContentLoaded", function() {


            var queryString = window.location.search;
            var urlParams = new URLSearchParams(queryString);
            var publishersParam = urlParams.get('publishers');
            const selectedPublishers = JSON.parse(decodeURIComponent(publishersParam));
            // Now, selectedPublishers contains the array from the previous page
            console.log(selectedPublishers);

            //change url to real one i.e. subscriber url and for respective ec2 instance
            const url = `http://ec2-54-82-71-245.compute-1.amazonaws.com:8082/events?publishers=${encodeURIComponent(JSON.stringify(selectedPublishers))}`;

            function fetchDataAndRender() {
                // Make an AJAX request to your Java code endpoint
                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                            // Handle the received data and update the HTML
                            updateHTML(data);
                    })
                    .catch(error => {
                            console.error('Error fetching data:', error);
                    });
            }

            // Function to update the HTML with the received data
            function updateHTML(data) {
                // Assuming you have a div with id "eventsContainer" to display the events
                var eventsContainer = document.getElementById('eventsContainer');

                // Clear existing content
                eventsContainer.innerHTML = '';

                // Iterate through the received data and create HTML elements
                data.forEach(event => {
                    var eventElement = document.createElement('div');
                eventElement.innerHTML = `
                        <strong>Event ID:</strong> ${event.eventId}<br>
                        <strong>Occasion:</strong> ${event.occasion}<br>
                        <strong>Publisher Name:</strong> ${event.publisherName}<br>
                        <strong>Event Location:</strong> ${event.eventLocation}<br>
                        <strong>Message:</strong> ${event.message}<br>
                        <hr>
                    `;
                eventsContainer.appendChild(eventElement);
                });
            }

            // Set interval to fetch data every 1 minute (60,000 milliseconds)
            setInterval(fetchDataAndRender, 30000);

            // Initial fetch when the page loads
            fetchDataAndRender();
        });
    </script>
</head>
<body>
<h1>Events</h1>
<div id="eventsContainer">
    <!-- Events will be displayed here -->
</div>
</body>
</html>
